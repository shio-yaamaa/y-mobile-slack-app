service:
  name: y-mobile-slack-app

plugins:
  - serverless-webpack

provider:
  name: aws
  runtime: nodejs8.10
  stage: dev
  region: ap-northeast-1
  timeout: 30
  environment:
    SENTRY_DSN: ${file(./.env.yml):SENTRY_DSN}

functions:
  notify:
    handler: src/functions/notify.handler
    events:
      - schedule: cron(0 15 * * ? *)
  fetch:
    handler: src/functions/fetch.handler
  generate-chart-url:
    handler: src/functions/generate-chart-url.handler

resources:
  Resources:
    DataUsageRecordsTable:
      Type: AWS::DynamoDB::Table
      Properties:
        TableName: DataUsageRecords
        KeySchema:
          - AttributeName: pk
            KeyType: HASH
          - AttributeName: sk
            KeyType: RANGE
        AttributeDefinitions:
          - AttributeName: pk
            AttributeType: S
          - AttributeName: sk
            AttributeType: S
        ProvisionedThroughput:
          ReadCapacityUnits: 1
          WriteCapacityUnits: 1

package:
  exclude:
    - .git/**
    - README.md